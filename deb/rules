#!/usr/bin/make -f
# Made with the aid of debmake, by Christoph Lameter,
# based on the sample debian/rules file for GNU hello by Ian Jackson.

package=scriptix
BV=$(shell cat ./configure.in | grep -E "^BASE_VERSION=" | sed 's/BASE_VERSION=//')

devpkg=libscriptix-dev
libpkg=libscriptix$(BV)
binpkg=scriptix

build:
	dh_testdir
	dh_clean -k
	dh_installdirs
	
	./configure --prefix=/usr
	$(MAKE)
	touch build

	dh_movefiles

clean:
	dh_testdir

	-rm -f build
	-$(MAKE) dist-clean
	-rm -f `find . -name "*~"`
	dh_clean

binary-indep: build
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.

binary-arch: checkroot build
	dh_testdir

	-rm -rf debian/tmp
	install -d debian/tmp
	cd debian/tmp && install -d `cat ../dirs`
	$(MAKE) install DESTDIR=`pwd`/debian/tmp
	install -D -d debian/$(devpkg)/usr/lib
	install -D -d debian/$(devpkg)/usr/bin
	install -D -d debian/$(devpkg)/usr/include/scriptix
	install -D -d debian/$(libpkg)/usr/lib
	mv debian/tmp/usr/include/scriptix/*.h debian/$(devpkg)/usr/include/scriptix
	mv debian/tmp/usr/lib/*.a debian/$(devpkg)/usr/lib
	mv debian/tmp/usr/lib/*.so.$(BV) debian/$(libpkg)/usr/lib
	mv debian/tmp/usr/bin/scriptix-conf debian/$(devpkg)/usr/bin
	rm -rf debian/tmp/usr/include
	rm -rf debian/tmp/usr/lib
	rm -f debian/tmp/usr/share/doc/scriptix/COPYING

	dh_installdocs -a
	dh_undocumented -pscriptix scriptix.1
	dh_undocumented -plibscriptix-dev scriptix-conf.1
	dh_installchangelogs -a
	dh_strip -pscriptix
	dh_strip -plibscriptix$(BV)
	dh_link -a
	dh_compress -a
	dh_fixperms -a
	dh_makeshlibs -a
	dh_installdeb -a
	dh_shlibdeps -a
	dh_gencontrol -a
	echo 'if [ "$$1" = "configure" ]; then ldconfig ; fi' >> debian/libscriptix$(BV)/DEBIAN/postinst
	dh_md5sums -a
	dh_builddeb -a

binary: binary-indep binary-arch

.PHONY: binary binary-arch binary-indep clean checkroot
