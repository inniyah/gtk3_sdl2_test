prefix := @prefix@

debian: all
	if [ ! -d debian ] ; then ln -s deb debian ; fi

all:
	( cd include ; make all )
	( cd lib ; make all )
	( cd bin ; make all )
	( cd test ; make all )
	( cd deb ; make all )

clean:
	( cd include ; make clean )
	( cd lib ; make clean )
	( cd bin ; make clean )
	( cd test ; make clean )

dist-clean:
	rm -f config.cache config.status config.log
	( cd include ; make dist-clean )
	( cd lib ; make dist-clean )
	( cd bin ; make dist-clean )
	( cd test ; make dist-clean )

install: all
	( cd include ; make install prefix=$(prefix) DESTDIR=$(DESTDIR) )
	( cd lib ; make install prefix=$(prefix) DESTDIR=$(DESTDIR) )
	( cd bin ; make install prefix=$(prefix) DESTDIR=$(DESTDIR) )
	install -d $(DESTDIR)/$(prefix)/share/doc/scriptix
	install -m 0644 README COPYING $(DESTDIR)/$(prefix)/share/doc/scriptix

dist: all
	rm -rf scriptix/
	mkdir scriptix
	cp scriptix.spec scriptix.spec.in scriptix.vim README COPYING INSTALL Makefile Makefile.in configure configure.in api.lst api.chk check-api.sh scriptix/
	( cd include ; make dist )
	( cd lib ; make dist )
	( cd bin ; make dist )
	( cd test ; make dist )
	( cd deb ; make dist )
	mv scriptix/ scriptix-@VERSION@/
	tar -zcf scriptix-@VERSION@.tar.gz scriptix-@VERSION@/
	rm -rf scriptix-@VERSION@/

deb:
	if [ ! -d debian/ ] ; then ln -s deb debian ; fi
	debuild -rfakeroot

rpm: dist
	rpm -ta scriptix-@VERSION@.tar.gz

.PHONY: deb rpm dist install clean all dist-clean
